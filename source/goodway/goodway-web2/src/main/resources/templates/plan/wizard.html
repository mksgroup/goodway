<!DOCTYPE html>
<html class="loading" lang="en" data-textdirection="ltr"
	xmlns:th="http://www.thymeleaf.org">
<head>
<th:block th:include="fragments/head"></th:block>
</head>
<body
	class="horizontal-layout horizontal-top-icon-menu 2-columns   menu-expanded"
	data-open="hover" data-menu="horizontal-menu" data-col="2-columns">
	<!-- fixed-top-->
	<th:block th:include="fragments/nav"></th:block>
	<!-- ////////////////////////////////////////////////////////////////////////////-->
	<!-- Horizontal navigation-->
	<th:block th:include="fragments/hnav"></th:block>
	<!-- Horizontal navigation-->

	<th:block th:include="fragments/plan/wizard"></th:block>

	<th:block th:include="fragments/footer"></th:block>
    
    <!-- Refer: http://mks.com.vn/themes/robust-admin/app-assets/js/scripts/forms/wizard-steps.js -->
    <script>
        // Wizard tabs with numbers setup
        $(".number-tab-steps").steps({
            headerTag: "h6",
            bodyTag: "fieldset",
            transitionEffect: "fade",
            titleTemplate: '<span class="step">#index#</span> #title#',
            labels: {
                finish: 'Submit'
            },
            onFinished: function (event, currentIndex) {
                alert("Form1 submitted.");
            }
        });
    
        // Wizard tabs with icons setup
        $(".icons-tab-steps").steps({
            headerTag: "h6",
            bodyTag: "fieldset",
            transitionEffect: "fade",
            titleTemplate: '<span class="step">#index#</span> #title#',
            labels: {
                finish: submit
            },
            onFinished: function (event, currentIndex) {
                // alert("Form2 submitted.");
                console.log("event=" + event);
                console.log("currentIndex=" + currentIndex);
            	submitWizard();
            }
        });
    
        // Vertical tabs form wizard setup
        $(".vertical-tab-steps").steps({
            headerTag: "h6",
            bodyTag: "fieldset",
            transitionEffect: "fade",
            stepsOrientation: "vertical",
            titleTemplate: '<span class="step">#index#</span> #title#',
            labels: {
                finish: 'Submit'
            },
            onFinished: function (event, currentIndex) {
                alert("Form3 submitted.");
            }
        });
    
        // Validate steps wizard
    
        // Show form
        var form = $(".steps-validation").show();
    
        $(".steps-validation").steps({
            headerTag: "h6",
            bodyTag: "fieldset",
            transitionEffect: "fade",
            titleTemplate: '<span class="step">#index#</span> #title#',
            labels: {
                finish: 'Submit'
            },
            onStepChanging: function (event, currentIndex, newIndex)
            {
                // Allways allow previous action even if the current form is not valid!
                if (currentIndex > newIndex)
                {
                    return true;
                }
                // Forbid next action on "Warning" step if the user is to young
                if (newIndex === 3 && Number($("#age-2").val()) < 18)
                {
                    return false;
                }
                // Needed in some cases if the user went back (clean up)
                if (currentIndex < newIndex)
                {
                    // To remove error styles
                    form.find(".body:eq(" + newIndex + ") label.error").remove();
                    form.find(".body:eq(" + newIndex + ") .error").removeClass("error");
                }
                form.validate().settings.ignore = ":disabled,:hidden";
                return form.valid();
            },
            onFinishing: function (event, currentIndex)
            {
                form.validate().settings.ignore = ":disabled";
                return form.valid();
            },
            onFinished: function (event, currentIndex)
            {
                alert("4.Submitted!");
            }
        });
    
        // Initialize validation
        $(".steps-validation").validate({
            ignore: 'input[type=hidden]', // ignore hidden fields
            errorClass: 'danger',
            successClass: 'success',
            highlight: function(element, errorClass) {
                $(element).removeClass(errorClass);
            },
            unhighlight: function(element, errorClass) {
                $(element).removeClass(errorClass);
            },
            errorPlacement: function(error, element) {
                error.insertAfter(element);
            },
            rules: {
                email: {
                    email: true
                }
            }
        });
    
    
        // Initialize plugins
        // ------------------------------
    
        // Date & Time Range
        $('.datetime').daterangepicker({
            timePicker: true,
            timePickerIncrement: 30,
            locale: {
                format: 'MM/DD/YYYY h:mm A'
            }
        });
    </script>

	<!-- Display Vehicle -->
	<script>
        // Lưu đối tượng table kết quả search
        var resultTable = null;
        var orderTable = null;
        var vehicleData;
        var dataOrderDatatable = null;
    
    	function submitWizard() {
    		var selectedOrders = [];
            $("input:checkbox[name=orderRow]:checked").each(function(){
            	selectedOrders.push($(this).val());
            });
            console.log(selectedOrders);
    
            var selectedVehicles = [];
            $("input:checkbox[name=vehicleRow]:checked").each(function(){
            	selectedVehicles.push($(this).val());
            });
            console.log(selectedVehicles);
    
            
       	    var frmData = {};
            frmData["vehicleIds"] = selectedVehicles;
            frmData["orderIds"] = selectedOrders;
            
            $.ajax({
                
                url : _ctx + "plan/makePlan",
                type : "POST",
                contentType: "application/json",
                dataType: 'json',
                data: JSON.stringify(frmData),
                
                success : function(result) {
                  	console.log("result=" + result);
                    alert('success');
                },
                error : function() {
                    console.log("Error!");
                }
            });
        }
  	
        $(document).ready(function() {
    
        	// Khởi tạo Table kết quả
    	    if (resultTable == null) {
    	        $("#resultTable").DataTable({
    	            ajax: {'url': _ctx + 'vehicle/load-vehicle', 'dataSrc': ''},
    	            "columns": [
    	            	  { 
    		            	   "render": function(data, type, full, meta){
    		            		   return '<input type="checkbox" name="vehicleRow" value="' + full.id + '">';
    			            	   } 
    	            	   },
    	               	   { "data": "name" },
    	               	   { "data": "length" },
    	               	   { "data": "width" },
    	               	   { "data": "height" },
    	               	   { "data": "capacity" }
    	                   ],
    	              
    
    	           });
    	   	} else {
    	           resultTable.fnDraw();
    	    }
    
    		
    	    if (orderTable == null) {
    	        dataOrderDatatable = $("#orderTable").DataTable({
    	            ajax: {'url': _ctx + 'plan/load-orderCustomer', 'dataSrc': ''},
    	            "columns": [
    	            	   { 
    		            	   "render": function(data, type, full, meta){
    		            		   return '<input type="checkbox" name="orderRow" value="' + full[0] + '">';
    			            	   } 
    	            	   },
    	              	   { "data": 1,
    		              	   "render" : function(data, row, meta){
    									data = '<a href="order/edit?orderCd='+ data + '">' + data +'</a>';
    			              	   return data;
    				            }
    	              	    },
    	               	   { "data": 2 },
    	               	   { "data": 3 },
    	               	   { "data": 4 },
    	               	   { "data": 5 }
    	               
    	                   ],
    	                   "initComplete": function(settings, json){ 
                               var info = this.api().page.info();
                               total.innerHTML = info.recordsTotal;
                           }
    	             
    	           });
    	   	} else {
    	           resultTable.fnDraw();
    	    }
    	    
    		
    		$('a[href^="#finish"]').on('click', function(e){
    			e.preventDefault();
    			console.log(dataOrderDatatable.rows({selected: true}));  
    		});
    
    	    function getCustomerData(handleData) {
    	        $.ajax({
    	            url : _ctx + "customer/load-customer",
    	            type : "GET",
    	            contentType: "application/json",
    	            dataType: 'json',
    
    	            success : function(result) {
    	            	handleData(result);
    	            },
    	            error : function() {
    	                console.log("Error!");
    	            }
    	        });
            }
    
    // 	    if (orderTable == null) {
    //     		getCustomerData(function(output){
    //     			   var table = $("#orderTable").DataTable();
    //                    for(var i = 0; i < output.length; i++){
    //                    var customer = output[i];
    //                    for(var j = 0; j < customer.orderMasterList.length; j++){
    //                 	      var order = customer.orderMasterList[j];
    
    //                           table.row.add(['<a href="order/edit?orderCd='+order.name + '">' +order.name +'</a>', customer.name, customer.phone, customer.addr, order.deliveryDate, null, '<input type="checkbox" id="input-15">']).draw();
    //                      }
    //                   }
    //               }); 
    //         } else {
    //         	orderTable.fnDraw();
    //         }
    
    });     
        	
    </script>
	

</body>
</html>