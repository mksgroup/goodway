<!DOCTYPE html>
<html class="loading" lang="en" data-textdirection="ltr"
	xmlns:th="http://www.thymeleaf.org">
<head>
<th:block th:include="fragments/head"></th:block>
</head>
<body
	class="horizontal-layout horizontal-top-icon-menu 2-columns   menu-expanded"
	data-open="hover" data-menu="horizontal-menu" data-col="2-columns">
	<!-- fixed-top-->
	<th:block th:include="fragments/nav"></th:block>
	<!-- ////////////////////////////////////////////////////////////////////////////-->
	<!-- Horizontal navigation-->
	<th:block th:include="fragments/hnav"></th:block>
	<!-- Horizontal navigation-->

	<th:block th:include="fragments/plan/wizard"></th:block>

	<th:block th:include="fragments/footer"></th:block>

	<!-- Display Vehicle -->
	<script>
    // Lưu đối tượng table kết quả search
    var resultTable = null;
    var orderTable = null;
    var vehicleData;
    var dataOrderDatatable = null;
  	
    $(document).ready(function() {

    	// Khởi tạo Table kết quả
	    if (resultTable == null) {
	        $("#resultTable").DataTable({
	            ajax: {'url': _ctx + 'vehicle/load-vehicle', 'dataSrc': ''},
	            "columns": [
	            	  { 
		            	   "render": function(data, type, full, meta){
		            		   return '<input type="checkbox" name="vehicleRow" value="' + full.id + '">';
			            	   } 
	            	   },
	               	   { "data": "name" },
	               	   { "data": "length" },
	               	   { "data": "width" },
	               	   { "data": "height" },
	               	   { "data": "capacity" }
	                   ],
	              

	           });
	   	} else {
	           resultTable.fnDraw();
	    }

		
	    if (orderTable == null) {
	        dataOrderDatatable = $("#orderTable").DataTable({
	            ajax: {'url': _ctx + 'plan/load-orderCustomer', 'dataSrc': ''},
	            "columns": [
	            	   { 
		            	   "render": function(data, type, full, meta){
		            		   return '<input type="checkbox" name="orderRow" value="' + full[0] + '">';
			            	   } 
	            	   },
	              	   { "data": 1,
		              	   "render" : function(data, row, meta){
									data = '<a href="order/edit?orderCd='+ data + '">' + data +'</a>';
			              	   return data;
				            }
	              	    },
	               	   { "data": 2 },
	               	   { "data": 3 },
	               	   { "data": 4 },
	               	   { "data": 5 }
	               
	                   ],
	                   "initComplete": function(settings, json){ 
                           var info = this.api().page.info();
                           total.innerHTML = info.recordsTotal;
                       }
	             
	           });
	   	} else {
	           resultTable.fnDraw();
	    }
	    
		
		$('a[href^="#finish"]').on('click', function(e){
			e.preventDefault();
			console.log(dataOrderDatatable.rows({selected: true}));  

			var selectedOrders = [];
            $("input:checkbox[name=orderRow]:checked").each(function(){
            	selectedOrders.push($(this).val());
            });
            console.log(selectedOrders);

            var selectedVehicles = [];
            $("input:checkbox[name=vehicleRow]:checked").each(function(){
            	selectedVehicles.push($(this).val());
            });
            console.log(selectedVehicles);

            
       	 var frmData = {};
            frmData["vehicleIds"] = selectedVehicles;
            frmData["orderIds"] = selectedOrders;
            
            $.ajax({
                
                url : _ctx + "plan/makePlan",
                type : "POST",
                contentType: "application/json",
                dataType: 'json',
                data: JSON.stringify(frmData),
                
                success : function(result) {
                  	console.log(result);
                    alert('success');
                },
                error : function() {
                    console.log("Error!");
                }
            });
		});
	    
    	
    	
	    function getCustomerData(handleData) {
	        $.ajax({
	            url : _ctx + "customer/load-customer",
	            type : "GET",
	            contentType: "application/json",
	            dataType: 'json',

	            success : function(result) {
	            	handleData(result);
	            },
	            error : function() {
	                console.log("Error!");
	            }
	        });
        }

// 	    if (orderTable == null) {
//     		getCustomerData(function(output){
//     			   var table = $("#orderTable").DataTable();
//                    for(var i = 0; i < output.length; i++){
//                    var customer = output[i];
//                    for(var j = 0; j < customer.orderMasterList.length; j++){
//                 	      var order = customer.orderMasterList[j];

//                           table.row.add(['<a href="order/edit?orderCd='+order.name + '">' +order.name +'</a>', customer.name, customer.phone, customer.addr, order.deliveryDate, null, '<input type="checkbox" id="input-15">']).draw();
//                      }
//                   }
//               }); 
//         } else {
//         	orderTable.fnDraw();
//         }

});     
    	
</script>
	

</body>
</html>