<!DOCTYPE html>
<html class="loading" lang="en" data-textdirection="ltr" xmlns:th="http://www.thymeleaf.org">
<head>
    <th:block th:include="fragments/head"></th:block>
</head>
<body class="horizontal-layout horizontal-top-icon-menu 2-columns   menu-expanded" data-open="hover" data-menu="horizontal-menu" data-col="2-columns">
  <!-- fixed-top-->
    <th:block th:include="fragments/nav"></th:block>
  <!-- ////////////////////////////////////////////////////////////////////////////-->
  <!-- Horizontal navigation-->
    <th:block th:include="fragments/hnav"></th:block>
  <!-- Horizontal navigation-->

  <th:block th:include="fragments/order/search"></th:block>
  
  <th:block th:include="fragments/order/delete"></th:block>
  
  <th:block th:include="fragments/footer"></th:block>
  <script>
	$(document).ready(function () {
		$('input[type=search]').on('keyup'), function () {
			var value = $(this).val().toLowerCase();
            
			$('#resultTable tbody tr').filter(function () {
				$(this).toggle($(this).text().toLowerCase().indexOf(value) > -1)
			});
		};
	});
  </script>
  
  <script>
    // Lưu đối tượng table kết quả search
    var resultTable = null;
    
    $(document).ready(function () {
        
        if (resultTable == null) {
        	resultTable = $("#resultTable").DataTable({
                ajax: {'url': _ctx + 'plan/load-orderCustomer', 'dataSrc': ''},
                "columns": [
                    
                       { "data": 1,
                         "render" : function (data, row, meta) {
                               data = '<a href="' + _ctx + 'order/edit/'+ data + '">' + data +'</a>';
                               
                               return data;
                         }
                        },
                       { "data": 2 },
                       { "data": 3 },
                       { "data": 4 },
                       { "data": 5 },
                       { "data": null,
                         "render" : function (data, row, meta) {     
                                                 
                               return null;
                         }
                       },
                       { "data": 1,
                         "render" : function (data, row, meta) {
                               data = '<i class="fa fa-minus-circle" onClick="deleteOrder(\'' + data + '\')" />';
                                                    
                               return data;
                         }
                       }
                   
                       ],
                        "initComplete": function (settings, json) { 
                                var info = this.api().page.info();
                                total.innerHTML = info.recordsTotal;
                            }
               });
        } else {
            resultTable.fnDraw();
        }
    });
    
    function deleteOrder(orderCd) {
        
        $('#comfirmDelete').attr('value', orderCd);
        $('#deleteOrderCd').html(' <strong>' + orderCd + ' ?</strong>');
        
        $('#comfirmDeleteModal').modal('show');
    }

    $('#comfirmDelete').click(function (e) {
        var deleteOrderCd = $(this).val();
        console.log(deleteOrderCd);
        
        if (deleteOrderCd != null || deleteOrderCd != "") {
            
            $.ajax({
                url : _ctx + "order/delete?orderCd="+ deleteOrderCd,
                type : "GET",
                contentType: "application/json",
                dataType: 'json',
                success : function  (result) {
                    $('#deleteResult').fadeToggle('slow'); $('#deleteResult').fadeOut(5000); 
                    
//                  loadDataToOrderTable(result);
                    resultTable.ajax.reload();
                    $('#comfirmDeleteModal').modal('hide');
                },
                error : function () {
                    console.log("Error!");
                }
            });
        }   
    });
</script>
</body>
</html>